# üéØ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π

## üìã –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–°–∏—Å—Ç–µ–º–∞ —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π –±—ã–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è

#### –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∞** * (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ)
- **–°–æ–æ–±—â–µ—Å—Ç–≤–æ** * (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ) - –≤—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤
- **–¢–µ–∫—Å—Ç –∫–æ–Ω–∫—É—Ä—Å–Ω–æ–≥–æ –ø–æ—Å—Ç–∞** * (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ)
- **–§–æ—Ç–æ (–¥–æ 5 —à—Ç)** * (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ) - —Å–ø–∏—Å–æ–∫ URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è
- **–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ** (–≥–∞–ª–æ—á–∫–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–æ)
- **–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Telegram-–∫–∞–Ω–∞–ª** (–≥–∞–ª–æ—á–∫–∞)
- **Telegram-–∫–∞–Ω–∞–ª** (–ø–æ–ª–µ –≤–≤–æ–¥–∞, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Telegram)
- **–¢–µ–≥–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ—Å—Ç–≤** * (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ) - —Å–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤
- **–¢–µ–≥–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ) - —Å–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤

#### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π** * (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ, 1-100)
- **–ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ) - —Å–ø–∏—Å–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### –£—Å–ª–æ–≤–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–æ–∑—ã–≥—Ä—ã—à–∞
- **–°—Ç–∞—Ä—Ç —Ä–æ–∑—ã–≥—Ä—ã—à–∞** * (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ) - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
- **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∞** * (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ) - –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ)

#### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç —Å –∏—Ç–æ–≥–∞–º–∏** (–≥–∞–ª–æ—á–∫–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–æ)
- **–°–∫—Ä—ã—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤** (–≥–∞–ª–æ—á–∫–∞)
- **–ù–µ —É—á–∏—Ç—ã–≤–∞—Ç—å –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ –º–µ–Ω—è** (–≥–∞–ª–æ—á–∫–∞)
- **–ù–µ —É—á–∏—Ç—ã–≤–∞—Ç—å –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—é —Å–æ–æ–±—â–µ—Å—Ç–≤–∞** (–≥–∞–ª–æ—á–∫–∞)

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `raffles`

```sql
CREATE TABLE raffles (
    id VARCHAR PRIMARY KEY,
    name VARCHAR NOT NULL,
    community_id VARCHAR NOT NULL,
    contest_text TEXT NOT NULL,
    photos JSON NOT NULL,
    require_community_subscription BOOLEAN DEFAULT TRUE,
    require_telegram_subscription BOOLEAN DEFAULT FALSE,
    telegram_channel VARCHAR,
    required_communities JSON NOT NULL,
    partner_tags JSON DEFAULT '[]',
    winners_count INTEGER NOT NULL,
    blacklist_participants JSON DEFAULT '[]',
    start_date TIMESTAMP NOT NULL,
    end_date TIMESTAMP NOT NULL,
    max_participants INTEGER,
    publish_results BOOLEAN DEFAULT TRUE,
    hide_participants_count BOOLEAN DEFAULT FALSE,
    exclude_me BOOLEAN DEFAULT FALSE,
    exclude_admins BOOLEAN DEFAULT FALSE,
    status rafflestatus DEFAULT 'draft',
    participants_count INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### Enum `rafflestatus`
- `draft` - –ß–µ—Ä–Ω–æ–≤–∏–∫
- `active` - –ê–∫—Ç–∏–≤–Ω—ã–π
- `paused` - –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- `completed` - –ó–∞–≤–µ—Ä—à–µ–Ω
- `cancelled` - –û—Ç–º–µ–Ω–µ–Ω

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü
alembic upgrade head
```

### 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ó–∞–ø—É—Å–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö
python run_server_auto.py

# –ò–ª–∏ –æ–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫
python run_server.py
```

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```python
from src.utils.db_init import init_database
init_database()
```

## üìö API Endpoints

### –°–æ–∑–¥–∞–Ω–∏–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∞
```http
POST /api/v1/raffles/
Content-Type: application/json

{
    "name": "–ö–æ–Ω–∫—É—Ä—Å –Ω–∞ –ª—É—á—à–∏–π –ø–æ—Å—Ç",
    "community_id": "12345",
    "contest_text": "–£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –Ω–∞—à–µ–º –∫–æ–Ω–∫—É—Ä—Å–µ!",
    "photos": ["https://example.com/photo1.jpg"],
    "require_community_subscription": true,
    "require_telegram_subscription": false,
    "required_communities": ["@community1", "@community2"],
    "partner_tags": ["@partner1"],
    "winners_count": 5,
    "blacklist_participants": ["@user1"],
    "start_date": "2025-07-09T14:33:00",
    "end_date": "2025-08-09T11:33:00",
    "max_participants": 1000,
    "publish_results": true,
    "hide_participants_count": false,
    "exclude_me": false,
    "exclude_admins": false
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π
```http
GET /api/v1/raffles/?page=1&per_page=10&status=active
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–æ–∑—ã–≥—Ä—ã—à–∞
```http
GET /api/v1/raffles/{raffle_id}
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∞
```http
PUT /api/v1/raffles/{raffle_id}
Content-Type: application/json

{
    "name": "–û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ",
    "winners_count": 10
}
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
```http
PATCH /api/v1/raffles/{raffle_id}/status?status=active
```

### –£–¥–∞–ª–µ–Ω–∏–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∞
```http
DELETE /api/v1/raffles/{raffle_id}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
python test_raffle_api.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## üîß –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π: –º–∞–∫—Å–∏–º—É–º 5
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π: 1-100
- –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–∑–∂–µ –¥–∞—Ç—ã —Å—Ç–∞—Ä—Ç–∞
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```json
{
    "detail": [
        {
            "loc": ["body", "photos"],
            "msg": "ensure this value has at most 5 items",
            "type": "value_error.list.max_items"
        },
        {
            "loc": ["body", "end_date"],
            "msg": "–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–∑–∂–µ –¥–∞—Ç—ã —Å—Ç–∞—Ä—Ç–∞",
            "type": "value_error"
        }
    ]
}
```

## üìä –°—Ç–∞—Ç—É—Å—ã —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ä–æ–∑—ã–≥—Ä—ã—à–∞
1. **draft** - –°–æ–∑–¥–∞–Ω —á–µ—Ä–Ω–æ–≤–∏–∫
2. **active** - –†–æ–∑—ã–≥—Ä—ã—à –∞–∫—Ç–∏–≤–µ–Ω –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
3. **paused** - –†–æ–∑—ã–≥—Ä—ã—à –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
4. **completed** - –†–æ–∑—ã–≥—Ä—ã—à –∑–∞–≤–µ—Ä—à–µ–Ω, –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
5. **cancelled** - –†–æ–∑—ã–≥—Ä—ã—à –æ—Ç–º–µ–Ω–µ–Ω

### –ü—Ä–∞–≤–∏–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
- –ò–∑ `draft` –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ `active` –∏–ª–∏ `cancelled`
- –ò–∑ `active` –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ `paused`, `completed` –∏–ª–∏ `cancelled`
- –ò–∑ `paused` –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ `active` –∏–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –≤ `completed`/`cancelled`
- –ò–∑ `completed` –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
- –ò–∑ `cancelled` –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å

## üé® Swagger UI

Swagger UI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é:
- –ü—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
- –ü—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ö–µ–º –¥–∞–Ω–Ω—ã—Ö
- –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ–≥–∏ –≤ Swagger:
- **Raffles** - –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ä–æ–∑—ã–≥—Ä—ã—à–∞–º–∏
- **Communities** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞–º–∏
- **Notifications** - –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **RaffleCards** - –ö–∞—Ä—Ç–æ—á–∫–∏ —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π
- **RaffleCarouselCards** - –ö–∞—Ä—Ç–æ—á–∫–∏ –∫–∞—Ä—É—Å–µ–ª–∏

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check
```http
GET /health
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É—Ä–æ–≤–Ω–µ–º INFO –∏ –≤—ã—à–µ. –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É—Ä–æ–≤–Ω–µ–º ERROR.

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Pydantic —Å—Ö–µ–º—ã
2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª–µ–π
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤
4. **–ì–∏–±–∫–æ—Å—Ç—å**: –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ PATCH –∑–∞–ø—Ä–æ—Å—ã
5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API —á–µ—Ä–µ–∑ OpenAPI/Swagger

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–π
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ API 